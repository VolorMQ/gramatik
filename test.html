<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Fill-in-the-blank interactive</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 30px; }
h2 { color: #333; }
#story { margin-bottom: 20px; line-height: 1.6; font-size: 18px; }
.placeholder, .insertedWord {
  display: inline-block;
  min-width: 60px;
  padding: 5px;
  margin: 0 3px;
  border-bottom: 2px solid #555;
  vertical-align: middle;
  text-align: center;
}
.placeholder { background: #fff; cursor: grab; }
.insertedWord { background: #2196F3; color: #fff; cursor: grab; border-radius: 4px; }
#choices {
  margin-top: 20px;
  min-height: 50px;
  padding: 10px;
  border: 1px solid #ccc;
  background: #e9e9e9;
  border-radius: 5px;
}
.word {
  display: inline-block;
  padding: 8px 12px;
  margin: 5px;
  background: #4CAF50;
  color: #fff;
  border-radius: 5px;
  cursor: grab;
  user-select: none;
}
.word.dragging, .insertedWord.dragging { opacity: 0.5; }
#controls { margin-bottom: 15px; }
#check, #refresh, #generateWords { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin-right: 10px;}
#result { margin-top: 15px; font-weight: bold; font-size: 18px; }
</style>
</head>
<body>

<h2>Udfyld de manglende ord:</h2>

<div id="controls">
  <label>Antal ord til at inds√¶tte: <input type="number" id="numWords" min="1" max="10" value="3"></label>
  <button id="generateWords">Generer ord</button>
  <button id="refresh">Opdater tekst</button>
  <button id="check">Check</button>
</div>

<div id="story"></div>
<div id="choices"></div>
<div id="result"></div>

<script>
let texts = [];
let currentText = null;
let availableWords = [];
let selectedWords = [];
let dragged = null;
let fromChoice = false;

// –ó–∞–≥—Ä—É–∑–∫–∞ JSON —Å —Ä–∞—Å—Å–∫–∞–∑–∞–º–∏
fetch('texts.json')
  .then(res => res.json())
  .then(data => {
    texts = data;
    loadRandomText();
  });

// –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —Ç–µ–∫—Å—Ç–∞
function loadRandomText() {
  const randomIndex = Math.floor(Math.random() * texts.length);
  currentText = JSON.parse(JSON.stringify(texts[randomIndex])); // –≥–ª—É–±–æ–∫–∞—è –∫–æ–ø–∏—è
  generateWords();
}

// –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞
function shuffleArray(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏
function generateWords() {
  const num = parseInt(document.getElementById('numWords').value);

  // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–æ–≤–∞ –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
  let allWords = currentText.text.match(/\b[\w√¶√∏√•√Ü√ò√Ö]+\b/g);
  if (!allWords) allWords = [];
  const uniqueWords = [...new Set(allWords)];

  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º numWords –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤
  const maxWords = Math.min(num, uniqueWords.length);

  // –í—ã–±–∏—Ä–∞–µ–º —Ä–æ–≤–Ω–æ maxWords —Å–ª—É—á–∞–π–Ω—ã—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤
  selectedWords = shuffleArray(uniqueWords).slice(0, maxWords);

  renderStory();
  renderWords();
  document.getElementById('result').textContent = '';
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å placeholders –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤
function renderStory() {
  let newText = currentText.text;

  selectedWords.forEach(word => {
    const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(`\\b${escapedWord}\\b`, 'g');

    // –∑–∞–º–µ–Ω—è–µ–º –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –Ω–∞ –æ–¥–∏–Ω placeholder
    newText = newText.replace(regex, `<span class="placeholder" ondrop="dropWord(event)" ondragover="allowDrop(event)">___</span>`);
  });

  document.getElementById('story').innerHTML = newText;
}


// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ–≤
function renderWords() {
  const choicesDiv = document.getElementById('choices');
  choicesDiv.innerHTML = availableWords.map((w,i) =>
    `<div class="word" draggable="true" id="word${i}" ondragstart="dragWord(event)">${w}</div>`
  ).join('');
}

// Drag & Drop
function allowDrop(ev){ ev.preventDefault(); }

function dragWord(ev){
  dragged = ev.target;
  fromChoice = true;
  ev.dataTransfer.setData("text", ev.target.textContent);
  ev.target.classList.add('dragging');
}

function dropWord(ev){
  ev.preventDefault();
  const placeholder = ev.target;
  if(dragged){
    if(placeholder.classList.contains('insertedWord')){
      availableWords.push(placeholder.textContent);
    }
    const span = document.createElement('span');
    span.className = 'insertedWord';
    span.draggable = true;
    span.textContent = dragged.textContent;
    span.ondragstart = dragInsertedWord;
    placeholder.parentNode.replaceChild(span, placeholder);
    if(fromChoice){
      const index = availableWords.indexOf(dragged.textContent);
      if(index > -1) availableWords.splice(index, 1);
      renderWords();
    }
  }
  dragged.classList.remove('dragging');
}

function dragInsertedWord(ev){
  const wordEl = ev.target;
  dragged = wordEl;
  fromChoice = false;
  ev.dataTransfer.setData("text", wordEl.textContent);
  ev.target.classList.add('dragging');
  availableWords.push(wordEl.textContent);
  renderWords();
  const placeholder = document.createElement('span');
  placeholder.className = 'placeholder';
  placeholder.textContent = '___';
  placeholder.ondrop = dropWord;
  placeholder.ondragover = allowDrop;
  wordEl.parentNode.replaceChild(placeholder, wordEl);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞
document.getElementById('check').addEventListener('click', () => {
  const inserted = document.querySelectorAll('.insertedWord');
  let allCorrect = true;
  inserted.forEach((el, i) => {
    if(el.textContent.trim() === selectedWords[i]){
      el.style.background = '#d4edda';
      el.style.borderBottom = '2px solid green';
    } else {
      el.style.background = '#f8d7da';
      el.style.borderBottom = '2px solid red';
      allCorrect = false;
    }
  });
  document.getElementById('result').textContent = allCorrect ? 'Alle svar er korrekte! üéâ' : 'Nogle svar er forkerte. Pr√∏v igen.';
});

// –ö–Ω–æ–ø–∫–∏
document.getElementById('refresh').addEventListener('click', loadRandomText);
document.getElementById('generateWords').addEventListener('click', generateWords);
</script>


</body>
</html>
