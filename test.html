<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Fill-in-the-blank interactive</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 30px; }
h2 { color: #333; }
#story { margin-bottom: 20px; line-height: 1.6; font-size: 18px; }
.placeholder, .insertedWord {
  display: inline-block;
  min-width: 60px;
  padding: 5px;
  margin: 0 3px;
  border-bottom: 2px solid #555;
  vertical-align: middle;
  text-align: center;
}
.placeholder { background: #fff; cursor: grab; }
.insertedWord { background: #2196F3; color: #fff; cursor: grab; border-radius: 4px; }
#choices {
  margin-top: 20px;
  min-height: 50px;
  padding: 10px;
  border: 1px solid #ccc;
  background: #e9e9e9;
  border-radius: 5px;
}
.word {
  display: inline-block;
  padding: 8px 12px;
  margin: 5px;
  background: #4CAF50;
  color: #fff;
  border-radius: 5px;
  cursor: grab;
  user-select: none;
}
.word.dragging, .insertedWord.dragging { opacity: 0.5; }
#controls { margin-bottom: 15px; }
#check, #refresh, #generateWords { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin-right: 10px;}
#result { margin-top: 15px; font-weight: bold; font-size: 18px; }
</style>
</head>
<body>

<h2>Udfyld de manglende ord:</h2>

<div id="controls">
  <label>Antal ord til at indsÃ¦tte: <input type="number" id="numWords" min="1" max="10" value="3"></label>
  <button id="generateWords">Generer ord</button>
  <button id="refresh">Opdater tekst</button>
  <button id="check">Check</button>
</div>

<div id="story"></div>
<div id="choices"></div>
<div id="result"></div>

<script>
let texts = [];
let currentText = null;
let availableWords = [];
let selectedWords = [];
let dragged = null;
let fromChoice = false;

// Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° JSON Ñ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ð¼Ð¸
fetch('texts.json')
  .then(res => res.json())
  .then(data => {
    texts = data;
    loadRandomText();
  });

// Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ Ñ‚ÐµÐºÑÑ‚Ð°
function loadRandomText() {
  const randomIndex = Math.floor(Math.random() * texts.length);
  currentText = JSON.parse(JSON.stringify(texts[randomIndex])); // Ð³Ð»ÑƒÐ±Ð¾ÐºÐ°Ñ ÐºÐ¾Ð¿Ð¸Ñ
  generateWords();
}

// ÐŸÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ð°
function shuffleArray(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

// Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ñ… ÑÐ»Ð¾Ð² Ð´Ð»Ñ Ð²ÑÑ‚Ð°Ð²ÐºÐ¸
function generateWords() {
  const num = parseInt(document.getElementById('numWords').value);

  // Ð Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÐ¼ Ñ‚ÐµÐºÑÑ‚ Ð½Ð° ÑÐ»Ð¾Ð²Ð° (Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð½Ð°ÐºÐ¸ Ð¿Ñ€ÐµÐ¿Ð¸Ð½Ð°Ð½Ð¸Ñ)
  let allWords = currentText.text.match(/\b[\wÃ¦Ã¸Ã¥Ã†Ã˜Ã…]+\b/g);
  if (!allWords) allWords = [];

  // Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ»Ð¾Ð²Ð° Ð±Ñ‹Ð»Ð¸ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹
  const uniqueWords = [...new Set(allWords)];

  // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð°
  selectedWords = shuffleArray(uniqueWords).slice(0, Math.min(num, uniqueWords.length));

  // ÐšÐ¾Ð¿Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð² ÑÐ¿Ð¸ÑÐºÐµ
  availableWords = selectedWords.slice();

  renderStory();
  renderWords();
  document.getElementById('result').textContent = '';
}

// Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð° Ñ placeholders, Ð·Ð°Ð¼ÐµÐ½ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐžÐ”ÐÐž Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÐ»Ð¾Ð²Ð°
function renderStory() {
  let newText = currentText.text;

  selectedWords.forEach(word => {
    const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    // Ð¸Ñ‰ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿ÐµÑ€Ð²Ð¾Ðµ Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ
    const regex = new RegExp(`\\b${escapedWord}\\b`);
    newText = newText.replace(regex, `<span class="placeholder" ondrop="dropWord(event)" ondragover="allowDrop(event)">___</span>`);
  });

  document.getElementById('story').innerHTML = newText;
}


// ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÑÐ»Ð¾Ð²
function renderWords() {
  const choicesDiv = document.getElementById('choices');
  choicesDiv.innerHTML = availableWords.map((w,i) =>
    `<div class="word" draggable="true" id="word${i}" ondragstart="dragWord(event)">${w}</div>`
  ).join('');
}

// Drag & Drop
function allowDrop(ev){ ev.preventDefault(); }

function dragWord(ev){
  dragged = ev.target;
  fromChoice = true;
  ev.dataTransfer.setData("text", ev.target.textContent);
  ev.target.classList.add('dragging');
}

function dropWord(ev){
  ev.preventDefault();
  const placeholder = ev.target;
  if(dragged){
    if(placeholder.classList.contains('insertedWord')){
      availableWords.push(placeholder.textContent);
    }
    const span = document.createElement('span');
    span.className = 'insertedWord';
    span.draggable = true;
    span.textContent = dragged.textContent;
    span.ondragstart = dragInsertedWord;
    placeholder.parentNode.replaceChild(span, placeholder);
    if(fromChoice){
      const index = availableWords.indexOf(dragged.textContent);
      if(index > -1) availableWords.splice(index, 1);
      renderWords();
    }
  }
  dragged.classList.remove('dragging');
}

function dragInsertedWord(ev){
  const wordEl = ev.target;
  dragged = wordEl;
  fromChoice = false;
  ev.dataTransfer.setData("text", wordEl.textContent);
  ev.target.classList.add('dragging');
  availableWords.push(wordEl.textContent);
  renderWords();
  const placeholder = document.createElement('span');
  placeholder.className = 'placeholder';
  placeholder.textContent = '___';
  placeholder.ondrop = dropWord;
  placeholder.ondragover = allowDrop;
  wordEl.parentNode.replaceChild(placeholder, wordEl);
}

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°
document.getElementById('check').addEventListener('click', () => {
  const inserted = document.querySelectorAll('.insertedWord');
  let allCorrect = true;
  inserted.forEach((el, i) => {
    if(el.textContent.trim() === selectedWords[i]){
      el.style.background = '#d4edda';
      el.style.borderBottom = '2px solid green';
    } else {
      el.style.background = '#f8d7da';
      el.style.borderBottom = '2px solid red';
      allCorrect = false;
    }
  });
  document.getElementById('result').textContent = allCorrect ? 'Alle svar er korrekte! ðŸŽ‰' : 'Nogle svar er forkerte. PrÃ¸v igen.';
});

// ÐšÐ½Ð¾Ð¿ÐºÐ¸
document.getElementById('refresh').addEventListener('click', loadRandomText);
document.getElementById('generateWords').addEventListener('click', generateWords);
</script>


</body>
</html>
