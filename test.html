<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Udfyld de manglende ord</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
h2 { color: #333; }
#story { margin-bottom: 20px; line-height: 1.6; font-size: 18px; }
.placeholder, .insertedWord {
  display: inline-block;
  min-width: 60px;
  padding: 5px;
  margin: 0 3px;
  border-bottom: 2px solid #555;
  vertical-align: middle;
  text-align: center;
}
.placeholder { background: #fff; cursor: pointer; }
.insertedWord { background: #2196F3; color: #fff; cursor: pointer; border-radius: 4px; }
#choices {
  margin-top: 20px;
  min-height: 50px;
  padding: 10px;
  border: 1px solid #ccc;
  background: #e9e9e9;
  border-radius: 5px;
}
.word {
  display: inline-block;
  padding: 8px 12px;
  margin: 5px;
  background: #4CAF50;
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  user-select: none;
}
.word.dragging, .insertedWord.dragging { opacity: 0.5; }
#controls { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
#check, #refresh, #generateWords { padding: 10px 20px; font-size: 16px; cursor: pointer; }
#result { margin-top: 15px; font-weight: bold; font-size: 18px; }
label { font-size: 16px; }
input[type="checkbox"] { transform: scale(1.3); margin-left: 10px; }
@media (max-width: 600px) {
  body { font-size: 16px; }
  .word, .insertedWord { font-size: 16px; padding: 6px 10px; }
}
</style>
</head>
<body>

<h2>Udfyld de manglende ord:</h2>

<div id="controls">
  <label>Antal ord til at inds√¶tte:
    <input type="number" id="numWords" min="1" max="10" value="3">
  </label>
  <button id="generateWords">Generer ord</button>
  <button id="refresh">Opdater tekst</button>
  <button id="check">Check</button>
  <label>Mobil tilstand
    <input type="checkbox" id="mobileMode">
  </label>
</div>

<div id="story"></div>
<div id="choices"></div>
<div id="result"></div>

<script>
let texts = [];
let currentText = null;
let availableWords = [];
let selectedWords = [];
let dragged = null;
let selectedWordForTap = null;
let mobileMode = false;

// –ó–∞–≥—Ä—É–∑–∫–∞ JSON
fetch('texts.json')
  .then(res => res.json())
  .then(data => {
    texts = data;
    loadRandomText();
  });

function loadRandomText() {
  const randomIndex = Math.floor(Math.random() * texts.length);
  currentText = JSON.parse(JSON.stringify(texts[randomIndex]));
  generateWords();
}

function shuffleArray(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

function generateWords() {
  const num = parseInt(document.getElementById('numWords').value);
  let allWords = currentText.text.match(/\b[\w√¶√∏√•√Ü√ò√Ö]+\b/g) || [];

  // –ë–µ—Ä—ë–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
  let uniqueWords = [...new Set(allWords)];
  selectedWords = shuffleArray(uniqueWords).slice(0, Math.min(num, uniqueWords.length));
  availableWords = selectedWords.slice();

  renderStory();
  renderWords();
  document.getElementById('result').textContent = '';
}

function renderStory() {
  let newText = currentText.text;
  selectedWords.forEach(word => {
    const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(`\\b${escapedWord}\\b`);
    newText = newText.replace(regex, `<span class="placeholder" ondrop="dropWord(event)" ondragover="allowDrop(event)" onclick="tapPlaceholder(event)">___</span>`);
  });
  document.getElementById('story').innerHTML = newText;
}

function renderWords() {
  const choicesDiv = document.getElementById('choices');
  choicesDiv.innerHTML = availableWords.map((w,i) =>
    `<div class="word" draggable="${!mobileMode}" id="word${i}" ondragstart="dragWord(event)" onclick="tapWord(event)">${w}</div>`
  ).join('');
}

// === Drag & Drop ===
function allowDrop(ev){ ev.preventDefault(); }

function dragWord(ev){
  if (mobileMode) return;
  dragged = ev.target;
  ev.dataTransfer.setData("text", ev.target.textContent);
  ev.target.classList.add('dragging');
}

function dropWord(ev){
  if (mobileMode) return;
  ev.preventDefault();
  const placeholder = ev.target;
  if (dragged){
    const span = document.createElement('span');
    span.className = 'insertedWord';
    span.draggable = true;
    span.textContent = dragged.textContent;
    span.ondragstart = dragInsertedWord;
    span.onclick = tapInsertedWord;
    placeholder.parentNode.replaceChild(span, placeholder);
    availableWords = availableWords.filter(w => w !== dragged.textContent);
    renderWords();
  }
  dragged.classList.remove('dragging');
}

function dragInsertedWord(ev){
  if (mobileMode) return;
  dragged = ev.target;
  ev.dataTransfer.setData("text", ev.target.textContent);
  ev.target.classList.add('dragging');
  availableWords.push(ev.target.textContent);
  renderWords();
  const placeholder = document.createElement('span');
  placeholder.className = 'placeholder';
  placeholder.textContent = '___';
  placeholder.ondrop = dropWord;
  placeholder.ondragover = allowDrop;
  placeholder.onclick = tapPlaceholder;
  ev.target.parentNode.replaceChild(placeholder, ev.target);
}

// === –ú–æ–±–∏–ª—å–Ω—ã–π TAP-—Ä–µ–∂–∏–º ===
function tapWord(ev) {
  if (!mobileMode) return;
  selectedWordForTap = ev.target.textContent;
  document.querySelectorAll('.word').forEach(w => w.style.background = '#4CAF50');
  ev.target.style.background = '#2e7d32';
}

function tapPlaceholder(ev) {
  if (!mobileMode || !selectedWordForTap) return;
  const placeholder = ev.target;
  const span = document.createElement('span');
  span.className = 'insertedWord';
  span.textContent = selectedWordForTap;
  span.onclick = tapInsertedWord;
  placeholder.parentNode.replaceChild(span, placeholder);
  availableWords = availableWords.filter(w => w !== selectedWordForTap);
  selectedWordForTap = null;
  renderWords();
}

function tapInsertedWord(ev) {
  if (!mobileMode) return;
  const word = ev.target.textContent;
  availableWords.push(word);
  renderWords();
  const placeholder = document.createElement('span');
  placeholder.className = 'placeholder';
  placeholder.textContent = '___';
  placeholder.onclick = tapPlaceholder;
  ev.target.parentNode.replaceChild(placeholder, ev.target);
}

// === –ü—Ä–æ–≤–µ—Ä–∫–∞ ===
document.getElementById('check').addEventListener('click', () => {
  const inserted = document.querySelectorAll('.insertedWord');
  let correctCount = 0;
  inserted.forEach(el => {
    if (selectedWords.includes(el.textContent.trim())) {
      el.style.background = '#4CAF50';
      correctCount++;
    } else {
      el.style.background = '#f44336';
    }
  });
  const result = document.getElementById('result');
  result.textContent = correctCount === selectedWords.length
    ? 'Alle svar er korrekte! üéâ'
    : 'Nogle svar er forkerte. Pr√∏v igen.';
});

// === –ö–Ω–æ–ø–∫–∏ ===
document.getElementById('refresh').addEventListener('click', loadRandomText);
document.getElementById('generateWords').addEventListener('click', generateWords);
document.getElementById('mobileMode').addEventListener('change', e => {
  mobileMode = e.target.checked;
  renderWords();
});
</script>
</body>
</html>
