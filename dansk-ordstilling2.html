<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ordstilling – hovedspørgsmål</title>
<style>
:root{
  --bg:#fafafa; --ink:#1f2937; --line:#e5e7eb;
  --blue:#2563eb; --red:#ef4444; --green:#10b981; --amber:#f59e0b; --violet:#8b5cf6;
}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;line-height:1.5}
.page{max-width:980px;margin:32px auto;padding:0 16px}
h1{font-size:22px;margin:0 0 16px}
table{width:100%;border-collapse:collapse;border:1px solid var(--line);margin-bottom:16px}
th,td{border:1px solid var(--line);padding:10px;text-align:center;height:42px}
th{font-size:12px;text-transform:uppercase;background:#f8fafc}
.subj{color:var(--blue)}
.v1{color:var(--red)}
.adv{color:var(--amber)}
.v23{color:var(--red)}
.obj{color:var(--green)}
.sted{color:var(--violet)}
td.question{font-weight:900;font-size:24px;color:var(--red);}
#word-pool{display:flex;flex-wrap:wrap;gap:8px;margin-top:16px}
.word{padding:6px 10px;border-radius:6px;background:#eef2ff;color:#3730a3;font-weight:600;cursor:grab;user-select:none}
.pool-blank{background:#fff3bf;border:1px dashed #f59e0b;color:#92400e;font-weight:700}
#buttons{margin-top:12px;display:flex;gap:8px}
button{padding:8px 16px;background:var(--blue);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600}
button:disabled{opacity:0.5;cursor:default}
#translation{margin-top:12px;font-weight:600;color:#10b981}
#mobile-toggle{margin-bottom:12px}
</style>
</head>
<body>
<div class="page">
  <h1>Hovedspørgsmål – Omvendt ordstilling</h1>
  <label id="mobile-toggle">
    <input type="checkbox" id="mobileVersion"> MobilVersion (tap instead of drag)
  </label>

  <table class="schema">
    <thead>
      <tr>
        <th class="v1">verbum 1</th>
        <th class="subj">subjekt</th>
        <th class="adv">adverbium</th>
        <th class="v23">verbum 2–3</th>
        <th class="obj">objekt</th>
        <th class="sted">sted/tid</th>
        <th>❓</th>
      </tr>
    </thead>
    <tbody id="sentence-rows"></tbody>
  </table>

  <div id="word-pool"></div>
  <div id="buttons">
    <button id="check-button">Tjek</button>
    <button id="hint-button">Hjælp</button>
    <button id="reset-button">Nulstil</button>
  </div>
  <div id="translation"></div>
</div>

<script>
let sentences = [];
let selectedSentences = [];
let wordsPool = [];
let mobileMode = false;
let selectedWordIndex = null;

fetch('sentences1.json')
  .then(res => res.json())
  .then(data => {
    sentences = data.sentences;
    initSentences();
  })
  .catch(err => console.error("Fejl ved indlæsning af JSON:", err));

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function initSentences(){
  selectedSentences = shuffle([...sentences]).slice(0,3);
  const tbody = document.getElementById('sentence-rows');
  tbody.innerHTML = "";

  const columnOrder = ['verbum1','subjekt','adverbium','verbum2','objekt','sted/tid'];

  selectedSentences.forEach((s,i)=>{
    const tr = document.createElement('tr');
    tr.dataset.index = i;
    columnOrder.forEach(type=>{
      const td = document.createElement('td');
      td.dataset.type = type;

      if(type==='subjekt'){
        td.textContent = s.subjekt.word;
        td.dataset.wordIndex = -1;
      } else {
        td.addEventListener('dragover', ev=>{ if(!mobileMode) ev.preventDefault(); });
        td.addEventListener('drop', ev=>{ if(!mobileMode) dropWord(ev,td); });
        td.addEventListener('click', ()=>{ if(mobileMode) tapInsert(td); });
      }
      tr.appendChild(td);
    });

    const qTd = document.createElement('td');
    qTd.classList.add('question');
    qTd.textContent = '❓';
    tr.appendChild(qTd);

    tbody.appendChild(tr);
  });

  wordsPool = [];
  ['verbum1','adverbium','verbum2','objekt','sted/tid'].forEach(type=>{
    let typeWords = selectedSentences.map((s,index)=>({...s[type], sentenceIndex:index}));
    typeWords = shuffle(typeWords);
    typeWords.forEach(w=>{
      wordsPool.push({word:w.word,type:type,translation:w.translation,sentenceIndex:w.sentenceIndex,inPool:true});
    });
  });

  // Желтый blank
  wordsPool.push({word:'', type:'blank', translation:'', sentenceIndex:null, inPool:true});

  wordsPool = shuffle(wordsPool);
  renderWordPool();
  updateTranslation();
}

function renderWordPool(){
  const pool = document.getElementById('word-pool');
  pool.innerHTML = "";
  wordsPool.forEach((w,i)=>{
    if(!w.inPool) return;
    const div = document.createElement('div');
    if(w.type==='blank'){
      div.classList.add('word','pool-blank');
      div.textContent='(blank)';
    } else {
      div.classList.add('word');
      div.textContent=w.word;
    }
    div.dataset.type=w.type;
    div.dataset.index=i;

    if(mobileMode){
      div.style.cursor='pointer';
      div.draggable=false;
      div.onclick = ()=>{ selectedWordIndex=i; highlightSelection(div); };
    } else {
      div.style.cursor='grab';
      div.draggable=true;
      div.onclick=null;
      div.addEventListener('dragstart', ev=>{
        ev.dataTransfer.setData('text/plain', i);
        clearHighlights();
      });
    }
    pool.appendChild(div);
  });
}

function highlightSelection(div){
  document.querySelectorAll('#word-pool .word').forEach(el=>el.style.outline='');
  div.style.outline='2px solid red';
}

function tapInsert(td){
  if(selectedWordIndex===null) return;
  const idx = selectedWordIndex;
  const wordObj = wordsPool[idx];
  const oldWordIndex = td.dataset.wordIndex;

  if(wordObj.type==='blank'){
    td.textContent='';
    td.dataset.wordIndex=idx;
  } else {
    td.textContent=wordObj.word;
    td.dataset.wordIndex=idx;
    wordsPool[idx].inPool=false;
  }

  if(oldWordIndex!==undefined && oldWordIndex!=-1){
    const oldIdx=Number(oldWordIndex);
    if(!isNaN(oldIdx) && wordsPool[oldIdx] && wordsPool[oldIdx].type!=='blank'){
      wordsPool[oldIdx].inPool=true;
    }
  }

  selectedWordIndex=null;
  renderWordPool();
  updateTranslation();
}

function dropWord(ev, td){
  ev.preventDefault();
  const idx=ev.dataTransfer.getData('text/plain');
  const wordObj=wordsPool[idx];
  const oldWordIndex=td.dataset.wordIndex;

  if(wordObj.type==='blank'){
    td.textContent='';
    td.dataset.wordIndex=idx;
  } else {
    td.textContent=wordObj.word;
    td.dataset.wordIndex=idx;
    wordsPool[idx].inPool=false;
  }

  if(oldWordIndex!==undefined && oldWordIndex!=-1){
    const oldIdx=Number(oldWordIndex);
    if(!isNaN(oldIdx) && wordsPool[oldIdx] && wordsPool[oldIdx].type!=='blank'){
      wordsPool[oldIdx].inPool=true;
    }
  }

  renderWordPool();
  updateTranslation();
}

function clearHighlights(){
  document.querySelectorAll('#sentence-rows td').forEach(td=>td.style.backgroundColor='');
}

document.getElementById('mobileVersion').addEventListener('change', e=>{
  mobileMode = e.target.checked;
  selectedWordIndex=null;
  renderWordPool();
});

// Остальной код проверки, hint, reset и translation без изменений
document.getElementById('check-button').addEventListener('click', ()=>{
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    tr.querySelectorAll('td').forEach(td=>{
      const type=td.dataset.type;
      const correctWord=selectedSentences[rowIdx][type];
      const idx=td.dataset.wordIndex;
      if(idx===undefined) return;

      if(idx==-1){ td.style.backgroundColor='#d1fae5'; }
      else {
        const wordObj=wordsPool[idx];
        const expected=correctWord && correctWord.word ? correctWord.word : '';
        if(wordObj.type==='blank'){ td.style.backgroundColor=(expected==='')?'#d1fae5':'#f87171'; }
        else { td.style.backgroundColor=(wordObj.word===expected)?'#d1fae5':(wordObj.type===type?'#fef08a':'#f87171'); }
      }
    });
  });
});

document.getElementById('hint-button').addEventListener('click', ()=>{
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    const cells=Array.from(tr.querySelectorAll('td')).filter(td=>td.dataset.type!=='subjekt');
    if(cells.length===0) return;
    const randomCell=cells[Math.floor(Math.random()*cells.length)];
    const type=randomCell.dataset.type;
    const correctWord=selectedSentences[rowIdx][type];

    const idx=randomCell.dataset.wordIndex;
    let needInsert=false;
    if(!randomCell.textContent) needInsert=true;
    else if(idx!==undefined && idx!=-1){
      const wordObj=wordsPool[idx];
      if(wordObj.word!==correctWord.word || wordObj.sentenceIndex!==rowIdx){
        needInsert=true;
        if(wordsPool[idx] && wordsPool[idx].type!=='blank') wordsPool[idx].inPool=true;
      }
    }

    if(needInsert){
      randomCell.textContent=correctWord.word;
      randomCell.dataset.wordIndex=-1;
      for(let i=0;i<wordsPool.length;i++){
        const w=wordsPool[i];
        if(w.word===correctWord.word && w.type===type && w.sentenceIndex===rowIdx) w.inPool=false;
      }
    }
  });

  renderWordPool();
  updateTranslation();
  document.getElementById('hint-button').disabled=true;
});

document.getElementById('reset-button').addEventListener('click', ()=>{
  initSentences();
  document.getElementById('hint-button').disabled=false;
});

function updateTranslation(){
  const translationDiv=document.getElementById('translation');
  translationDiv.innerHTML='';
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    tr.querySelectorAll('td').forEach(td=>{
      const idx=td.dataset.wordIndex;
      if(idx!==undefined){
        let text='';
        if(idx==-1){ const type=td.dataset.type; text=td.textContent+' → '+selectedSentences[rowIdx][type].translation; }
        else {
          const wordObj=wordsPool[idx];
          if(wordObj.type!=='blank') text=wordObj.word+' → '+wordObj.translation;
        }
        if(text){ const p=document.createElement('div'); p.textContent=text; translationDiv.appendChild(p); }
      }
    });
  });
}
</script>
</body>
</html>
