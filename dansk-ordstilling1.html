<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ordstilling – hovedsætninger</title>
<style>
:root{
  --bg:#fafafa; --ink:#1f2937; --line:#e5e7eb;
  --blue:#2563eb; --red:#ef4444; --green:#10b981;
  --amber:#f59e0b; --violet:#8b5cf6;
}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;line-height:1.5}
.page{max-width:980px;margin:32px auto;padding:0 16px}
h1{font-size:22px;margin:0 0 16px}
table{width:100%;border-collapse:collapse;border:1px solid var(--line);margin-bottom:16px}
th,td{border:1px solid var(--line);padding:10px;text-align:center;height:42px}
th{font-size:12px;text-transform:uppercase;background:#f8fafc}
.subj{color:var(--blue)}
.v1{color:var(--red)}
.adv{color:var(--amber)}
.v23{color:var(--red)}
.obj{color:var(--green)}
.sted{color:var(--violet)}
#word-pool{display:flex;flex-wrap:wrap;gap:8px;margin-top:16px}
.word{padding:6px 10px;border-radius:6px;background:#eef2ff;color:#3730a3;font-weight:600;cursor:grab;user-select:none}
#check-button,#hint-button,#reset-button{margin-top:12px;padding:8px 16px;background:var(--blue);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;margin-right:8px}
</style>
</head>
<body>
<div class="page">
  <h1>Hovedsætninger – Ligefrem ordstilling</h1>

  <table>
    <thead>
      <tr>
        <th class="subj">subjekt</th>
        <th class="v1">verbum 1</th>
        <th class="adv">adverbium</th>
        <th class="v23">verbum 2–3</th>
        <th class="obj">objekt</th>
        <th class="sted">sted/tid</th>
      </tr>
    </thead>
    <tbody id="sentence-rows"></tbody>
  </table>

  <div id="word-pool"></div>
  <button id="check-button">Tjek</button>
  <button id="hint-button">Подсказка</button>
  <button id="reset-button">Сбросить</button>
</div>

<script>
let sentences = [];
let selectedSentences = [];
let wordsPool = [];

fetch('sentences.json')
  .then(res => res.json())
  .then(data => {
    sentences = data.sentences;
    initSentences();
  })
  .catch(err => console.error("Fejl ved indlæsning af JSON:", err));

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function initSentences(){
  selectedSentences = shuffle([...sentences]).slice(0,3);
  const tbody = document.getElementById('sentence-rows');
  tbody.innerHTML = "";

  selectedSentences.forEach((s,i)=>{
    const tr = document.createElement('tr');
    tr.dataset.index = i;
    ['subjekt','verbum1','adverbium','verbum2','objekt','sted/tid'].forEach(type=>{
      const td = document.createElement('td');
      td.dataset.type = type;
      td.addEventListener('dragover', ev=>ev.preventDefault());
      td.addEventListener('drop', ev=>dropWord(ev,td));
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  wordsPool = [];
  ['subjekt','verbum1','adverbium','verbum2','objekt','sted/tid'].forEach(type=>{
    let typeWords = selectedSentences.map((s, idx)=>({...s[type], sentenceIndex: idx}));
    typeWords = shuffle(typeWords);
    typeWords.forEach(w=>{
      wordsPool.push({word:w.word,type:type,translation:w.translation,sentenceIndex:w.sentenceIndex,inPool:true});
    });
  });
  wordsPool = shuffle(wordsPool);
  renderWordPool();
}

function renderWordPool(){
  const pool = document.getElementById('word-pool');
  pool.innerHTML = "";
  wordsPool.forEach((w,i)=>{
    if(w.inPool){
      const div = document.createElement('div');
      div.classList.add('word');
      div.textContent = w.word;
      div.dataset.type = w.type;
      div.dataset.index = i;
      div.draggable = true;
      div.addEventListener('dragstart', ev=>{
        ev.dataTransfer.setData('text/plain', i);
        // сброс всех подсветок при изменении
        document.querySelectorAll('#sentence-rows td').forEach(td=>td.style.backgroundColor='');
      });
      pool.appendChild(div);
    }
  });
}

function dropWord(ev, td){
  ev.preventDefault();
  const idx = ev.dataTransfer.getData('text/plain');
  const wordObj = wordsPool[idx];

  // вернуть старое слово обратно в пул
  if(td.dataset.wordIndex !== undefined){
    wordsPool[td.dataset.wordIndex].inPool = true;
  }

  td.textContent = wordObj.word;
  td.dataset.wordIndex = idx;
  wordsPool[idx].inPool = false;

  renderWordPool();
  // сброс подсветки
  document.querySelectorAll('#sentence-rows td').forEach(td=>td.style.backgroundColor='');
}

document.getElementById('check-button').addEventListener('click', ()=>{
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    tr.querySelectorAll('td').forEach(td=>{
      if(td.dataset.wordIndex!==undefined){
        const idx = td.dataset.wordIndex;
        const wordObj = wordsPool[idx];
        const correctWord = selectedSentences[rowIdx][td.dataset.type];
        if(wordObj.word === correctWord.word){
          td.style.backgroundColor = '#d1fae5'; // зеленый
        } else if(wordObj.type === td.dataset.type){
          td.style.backgroundColor = '#fef08a'; // желтый
        } else {
          td.style.backgroundColor = '#fecaca'; // красный
        }
      } else {
        // пустые ячейки считаются правильными
        td.style.backgroundColor = '';
      }
    });
  });
});

// Подсказка
document.getElementById('hint-button').addEventListener('click', ()=>{
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    const emptyCells = Array.from(tr.querySelectorAll('td')).filter(td=>!td.dataset.wordIndex);
    if(emptyCells.length===0) return;

    const randomCell = emptyCells[Math.floor(Math.random()*emptyCells.length)];
    const type = randomCell.dataset.type;
    const correctWord = selectedSentences[rowIdx][type];
    const wordIdx = wordsPool.findIndex(w=>w.word===correctWord.word && w.inPool);
    if(wordIdx===-1) return;

    randomCell.textContent = wordsPool[wordIdx].word;
    randomCell.dataset.wordIndex = wordIdx;
    wordsPool[wordIdx].inPool = false;
    renderWordPool();
  });
  document.querySelectorAll('#sentence-rows td').forEach(td=>td.style.backgroundColor='');
});

// Сброс всех слов в пул
document.getElementById('reset-button').addEventListener('click', ()=>{
  selectedSentences.forEach((s,rowIdx)=>{
    const tr = document.querySelector(`#sentence-rows tr[data-index="${rowIdx}"]`);
    tr.querySelectorAll('td').forEach(td=>{
      if(td.dataset.wordIndex!==undefined){
        wordsPool[td.dataset.wordIndex].inPool = true;
      }
      td.textContent = '';
      delete td.dataset.wordIndex;
    });
  });
  renderWordPool();
  document.querySelectorAll('#sentence-rows td').forEach(td=>td.style.backgroundColor='');
});
</script>
</body>
</html>
