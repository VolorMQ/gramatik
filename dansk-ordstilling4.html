<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ordstilling – Ledsætninger</title>
<style>
:root{
  --bg:#fafafa; --ink:#1f2937; --line:#e5e7eb;
  --blue:#2563eb; --red:#ef4444; --green:#10b981; --amber:#f59e0b; --violet:#8b5cf6; --purple:#9333ea;
}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;line-height:1.5}
.page{max-width:980px;margin:32px auto;padding:0 16px}
h1{font-size:22px;margin:0 0 16px}
table{width:100%;border-collapse:collapse;border:1px solid var(--line);margin-bottom:16px}
th,td{border:1px solid var(--line);padding:10px;text-align:center;height:42px}
th{font-size:12px;text-transform:uppercase;background:#f8fafc}
.subj{color:var(--blue)}
.v1{color:var(--red)}
.lkonj{color:var(--purple); font-weight:600;}
.adv{color:var(--amber)}
.v23{color:var(--red)}
.obj{color:var(--green)}
.sted{color:var(--violet)}
#word-pool{display:flex;flex-wrap:wrap;gap:8px;margin-top:16px}
.word{padding:6px 10px;border-radius:6px;background:#eef2ff;color:#3730a3;font-weight:600;cursor:grab;user-select:none}
#buttons{margin-top:12px;display:flex;gap:8px}
button{padding:8px 16px;background:var(--blue);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600}
button:disabled{opacity:0.5;cursor:default}
#translation{margin-top:12px;font-weight:600;color:#10b981}
</style>
</head>
<body>
<div class="page">
  <h1>Ledsætninger</h1>

  <table class="schema">
    <thead>
      <tr>
        <th>subjekt1</th>
        <th>adverbium1</th>
        <th>verbum1_1</th>
        <th>verbium2-3_1</th>
        <th>objekt1</th>
        <th>sted/tid1</th>
        <th>comma</th>
        <th>lkonj</th>
        <th>subjekt2</th>
        <th>adverbium2</th>
        <th>verbum1_2</th>
        <th>verbium2-3_2</th>
        <th>objekt2</th>
        <th>sted/tid2</th>
      </tr>
    </thead>
    <tbody id="sentence-rows"></tbody>
  </table>

  <div id="word-pool"></div>
  <div id="buttons">
    <button id="check-button">Tjek</button>
    <button id="reset-button">Nulstil</button>
  </div>
  <div id="translation"></div>
</div>

<script>
let sentences = [];
let wordsPool = [];

fetch('words.json')
  .then(res => res.json())
  .then(data => {
    sentences = data.sentences;
    initSentences();
  })
  .catch(err => console.error("Fejl ved indlæsning af JSON:", err));

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function initSentences(){
  const tbody = document.getElementById('sentence-rows');
  tbody.innerHTML = "";

  sentences.forEach((s, i) => {
    const tr = document.createElement('tr');
    tr.dataset.index = i;

    const columnOrder = ['subjekt1','adverbium1','verbum1_1','verbium2-3_1','objekt1','sted/tid1','comma','lkonj','subjekt2','adverbium2','verbum1_2','verbium2-3_2','objekt2','sted/tid2'];

    columnOrder.forEach(type => {
      const td = document.createElement('td');
      td.dataset.type = type;

      if(type.startsWith('subjekt') || type==='comma' || type==='lkonj'){
        td.textContent = s[type].word;
        td.dataset.wordIndex = -1;
      } else {
        td.addEventListener('dragover', ev => ev.preventDefault());
        td.addEventListener('drop', ev => dropWord(ev, td));
      }

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  wordsPool = [];
  const typesForPool = ['adverbium1','verbum1_1','verbium2-3_1','objekt1','sted/tid1','adverbium2','verbum1_2','verbium2-3_2','objekt2','sted/tid2'];
  typesForPool.forEach(type => {
    sentences.forEach((s,index) => {
      if(s[type] && s[type].word){
        wordsPool.push({...s[type], type: type, sentenceIndex: index, inPool:true});
      }
    });
  });

  wordsPool = shuffle(wordsPool);
  renderWordPool();
  updateTranslation();
}

function renderWordPool(){
  const pool = document.getElementById('word-pool');
  pool.innerHTML = "";
  wordsPool.forEach((w,i)=>{
    if(!w.inPool) return;
    const div = document.createElement('div');
    div.classList.add('word');
    div.textContent = w.word;
    div.dataset.type = w.type;
    div.dataset.index = i;
    div.draggable = true;
    div.addEventListener('dragstart', ev=>{
      ev.dataTransfer.setData('text/plain', i);
    });
    pool.appendChild(div);
  });
}

function dropWord(ev, td){
  ev.preventDefault();
  const idx = ev.dataTransfer.getData('text/plain');
  const wordObj = wordsPool[idx];
  const oldWordIndex = td.dataset.wordIndex;

  td.textContent = wordObj.word;
  td.dataset.wordIndex = idx;
  wordsPool[idx].inPool = false;

  if(oldWordIndex !== undefined && oldWordIndex != -1){
    wordsPool[oldWordIndex].inPool = true;
  }

  renderWordPool();
  updateTranslation();
}

document.getElementById('check-button').addEventListener('click', ()=>{
  document.querySelectorAll('#sentence-rows tr').forEach((tr,rowIdx)=>{
    tr.querySelectorAll('td').forEach(td=>{
      const type = td.dataset.type;
      const correctWord = sentences[rowIdx][type];
      const idx = td.dataset.wordIndex;
      if(idx===undefined) return;

      if(idx==-1){ td.style.backgroundColor='#d1fae5';
      } else {
        const wordObj = wordsPool[idx];
        if(wordObj.word===correctWord.word){ td.style.backgroundColor='#d1fae5';
        } else if(wordObj.type===type){ td.style.backgroundColor='#fef08a';
        } else { td.style.backgroundColor='#f87171'; }
      }
    });
  });
});

document.getElementById('reset-button').addEventListener('click', ()=>{
  initSentences();
});

function updateTranslation(){
  const translationDiv = document.getElementById('translation');
  translationDiv.innerHTML = '';
  sentences.forEach((s,rowIdx)=>{
    const columnOrder = ['subjekt1','adverbium1','verbum1_1','verbium2-3_1','objekt1','sted/tid1','comma','lkonj','subjekt2','adverbium2','verbum1_2','verbium2-3_2','objekt2','sted/tid2'];
    columnOrder.forEach(type=>{
      let text = '';
      const td = document.querySelector(`#sentence-rows tr[data-index="${rowIdx}"] td[data-type="${type}"]`);
      if(!td) return;
      if(td.dataset.wordIndex==-1){
        text = td.textContent + ' → ' + s[type].translation;
      } else {
        const idx = td.dataset.wordIndex;
        if(idx!==undefined){
          const w = wordsPool[idx];
          if(!w || !w.inPool){
            text = td.textContent + ' → ' + s[type].translation;
          } else {
            text = w.word + ' → ' + w.translation;
          }
        }
      }
      if(text){
        const p = document.createElement('div');
        p.textContent = text;
        translationDiv.appendChild(p);
      }
    });
  });
}
</script>
</body>
</html>
