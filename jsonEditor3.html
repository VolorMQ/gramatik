<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Editor Hovedsætninger</title>
<style>
body { font-family: Arial; margin: 20px; }
select, button, label { margin: 5px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
input { width: 90%; box-sizing: border-box; margin: 2px 0; }
.delete-btn { cursor: pointer; color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>Editor Hovedsætninger</h1>

<label>Выберите базу: 
  <select id="fileSelect">
    <option value="sentences.json">Normal</option>
    <option value="sentences1.json">Invertion</option>
  </select>
</label>

<label>
  <input type="checkbox" id="editBoth" onchange="toggleEditBoth()"> Редактировать обе базы одновременно
</label>

<div id="selectedBases" style="margin:5px; font-weight:bold;"></div>

<button onclick="addSentence()">Добавить предложение</button>
<button onclick="saveToLocalFile()">Скачать JSON</button>

<table id="jsonTable">
<thead>
<tr>
<th>subjekt</th>
<th>verbum1</th>
<th>adverbium</th>
<th>verbum2</th>
<th>verbium3_infinitpartikle</th>
<th>verbium3_infinitiv</th>
<th>objekt1</th>
<th>konjuktion</th>
<th>objekt2</th>
<th>sted_tid_præposition</th>
<th>sted_tid_substantiv</th>
<th>Удалить</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
let jsonData = [];
let jsonData2 = [];
let currentFile = 'sentences1_new.json';
let editBoth = false;

async function loadSelectedFile() {
  currentFile = document.getElementById('fileSelect').value;
  try {
    const response = await fetch(currentFile);
    const data = await response.json();
    if (Array.isArray(data.sentences)) {
      jsonData = data.sentences;
      renderTable();
    } else {
      alert("Неверная структура JSON в " + currentFile);
      jsonData = [];
      renderTable();
    }
  } catch (e) {
    alert("Ошибка загрузки " + currentFile);
    jsonData = [];
    renderTable();
  }
}

async function loadSecondFile() {
  try {
    const response = await fetch('sentences1_new.json');
    const data = await response.json();
    if (Array.isArray(data.sentences)) {
      jsonData2 = data.sentences;
    } else {
      jsonData2 = [];
    }
  } catch {
    jsonData2 = [];
  }
}

function toggleEditBoth() {
  editBoth = document.getElementById('editBoth').checked;
  const select = document.getElementById('fileSelect');
  const label = document.getElementById('selectedBases');
  if(editBoth){
    select.disabled = true;
    label.textContent = 'Редактируем одновременно: Normal (sentences.json) и Invertion (sentences1.json)';
    loadSelectedFile();
    loadSecondFile();
  } else {
    select.disabled = false;
    const name = select.value === 'sentences1_new.json' ? 'Normal' : 'Invertion';
    label.textContent = name + ' (' + select.value + ')';
    loadSelectedFile();
  }
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';
  const keys = ['subjekt','verbum1','adverbium','verbum2','verbium3_infinitpartikle','verbium3_infinitiv','objekt1','konjuktion','objekt2','sted_tid_præposition','sted_tid_substantiv'];
  
  jsonData.forEach((sentence, index) => {
    const tr = document.createElement('tr');
    keys.forEach(key => {
      const td = document.createElement('td');
      td.innerHTML = `
        <input type="text" value="${sentence[key].word}" placeholder="word"
          oninput="updateCell(${index}, '${key}', 'word', this.value)">
        <input type="text" value="${sentence[key].translation}" placeholder="translation"
          oninput="updateCell(${index}, '${key}', 'translation', this.value)">
      `;
      tr.appendChild(td);
    });

    const delTd = document.createElement('td');
    delTd.innerHTML = `<span class="delete-btn" onclick="deleteSentence(${index})">&#10006;</span>`;
    tr.appendChild(delTd);

    tbody.appendChild(tr);
  });
}

function updateCell(rowIndex, key, prop, value) {
  jsonData[rowIndex][key][prop] = value;
  if(editBoth && jsonData2[rowIndex]) jsonData2[rowIndex][key][prop] = value;
}

function addSentence() {
  const emptySentence = {
    "subjekt":{"word":"","translation":""},
    "verbum1":{"word":"","translation":""},
    "adverbium":{"word":"","translation":""},
    "verbum2":{"word":"","translation":""},
    "verbium3_infinitpartikle":{"word":"","translation":""},
    "verbium3_infinitiv":{"word":"","translation":""},
    "objekt1":{"word":"","translation":""},
    "konjuktion":{"word":"","translation":""},
    "objekt2":{"word":"","translation":""},
    "sted_tid_præposition":{"word":"","translation":""},
    "sted_tid_substantiv":{"word":"","translation":""}
  };
  jsonData.push(emptySentence);
  if(editBoth) jsonData2.push(JSON.parse(JSON.stringify(emptySentence)));
  renderTable();
}

function deleteSentence(index) {
  jsonData.splice(index,1);
  if(editBoth) jsonData2.splice(index,1);
  renderTable();
}

function saveToLocalFile() {
  const blob1 = new Blob([JSON.stringify({ sentences: jsonData }, null, 2)], { type: 'application/json' });
  const url1 = URL.createObjectURL(blob1);
  const a1 = document.createElement('a');
  a1.href = url1;
  a1.download = 'sentences1_new.json';
  a1.click();
  URL.revokeObjectURL(url1);

  if(editBoth){
    const blob2 = new Blob([JSON.stringify({ sentences: jsonData2 }, null, 2)], { type: 'application/json' });
    const url2 = URL.createObjectURL(blob2);
    const a2 = document.createElement('a');
    a2.href = url2;
    a2.download = 'sentences1_new.json';
    a2.click();
    URL.revokeObjectURL(url2);
  }
}

document.getElementById('selectedBases').textContent =
  document.getElementById('fileSelect').value === 'sentences1_new.json' ? 
  'Normal (sentences1_new.json)' : 'Invertion (sentences1_new.json)';

loadSelectedFile();
</script>

</body>
</html>
